{% extends "base.html" %}

{% block title %}SpendSense - Evaluate Your Purchase{% endblock %}

{% block content %}
<section class="hero">
    <h2>Evaluate Your Purchase Decision</h2>
    <p>Enter your financial information below to get a personalized analysis</p>
</section>

<section class="form-section">
    <form method="POST" action="/evaluate" class="evaluation-form">
        <div class="form-group">
            <label for="monthly_income">Monthly Income (KSH)</label>
            <input type="number" id="monthly_income" name="monthly_income" placeholder="5000" step="0.01" min="0" required>
            <small>Your gross monthly income</small>
        </div>

        <div class="form-group">
            <label for="fixed_expenses">Fixed Monthly Expenses (KSH)</label>
            <input type="number" id="fixed_expenses" name="fixed_expenses" placeholder="1500" step="0.01" min="0" required>
            <small>Rent, utilities, insurance, etc.</small>
        </div>

        <div class="form-group">
            <label for="savings_goal">Monthly Savings Goal (KSH)</label>
            <input type="number" id="savings_goal" name="savings_goal" placeholder="500" step="0.01" min="0" required>
            <small>Amount you want to save each month</small>
        </div>

        <div class="divider"></div>

        <div id="items-container">
            <div class="item-entry" data-index="0">
                <div class="form-group">
                    <label for="item_name_0">Item Name</label>
                    <input type="text" id="item_name_0" name="items[0][name]" placeholder="e.g., Laptop" maxlength="200" required>
                </div>
                <div class="form-group">
                    <label for="item_cost_0">Cost (KSH)</label>
                    <input type="number" id="item_cost_0" name="items[0][cost]" placeholder="1200" step="0.01" min="0" required>
                </div>
            </div>
        </div>

        <button type="button" class="btn btn-secondary" id="addItemBtn">Add Another Item</button>

        <button type="submit" class="btn btn-primary" id="submitBtn">
            <span class="btn-text">Analyze Purchase</span>
            <span class="btn-loader" style="display:none;">⏳ Analyzing...</span>
        </button>
        <button type="reset" class="btn btn-secondary">Clear Form</button>
    </form>
</section>

<script>
const form = document.querySelector('.evaluation-form');
const submitBtn = document.getElementById('submitBtn');
const btnText = submitBtn.querySelector('.btn-text');
const btnLoader = submitBtn.querySelector('.btn-loader');
const itemsContainer = document.getElementById('items-container');
const addItemBtn = document.getElementById('addItemBtn');
let itemIndex = 1;

addItemBtn.addEventListener('click', function() {
    const itemEntry = document.createElement('div');
    itemEntry.className = 'item-entry';
    itemEntry.dataset.index = itemIndex;
    itemEntry.innerHTML = `
        <div class="form-group">
            <label for="item_name_${itemIndex}">Item Name</label>
            <input type="text" id="item_name_${itemIndex}" name="items[${itemIndex}][name]" placeholder="e.g., Phone" maxlength="200" required>
        </div>
        <div class="form-group">
            <label for="item_cost_${itemIndex}">Cost (KSH)</label>
            <input type="number" id="item_cost_${itemIndex}" name="items[${itemIndex}][cost]" placeholder="500" step="0.01" min="0" required>
        </div>
        <button type="button" class="btn btn-secondary btn-remove" onclick="this.parentElement.remove()">Remove</button>
    `;
    itemsContainer.appendChild(itemEntry);
    itemIndex++;
});

form.addEventListener('submit', function(e) {
    btnText.style.display = 'none';
    btnLoader.style.display = 'inline';
    submitBtn.disabled = true;
});

// Real-time validation feedback
const inputs = form.querySelectorAll('input[type="number"]');
inputs.forEach(input => {
    input.addEventListener('input', function() {
        if (this.value < 0) {
            this.setCustomValidity('Value must be positive');
        } else {
            this.setCustomValidity('');
        }
    });
});
</script>
</section>

<section class="info-section">
    <div class="info-card">
        <h3>How It Works</h3>
        <ul>
            <li>Enter your financial information</li>
            <li>We calculate your disposable income</li>
            <li>Risk is assessed based on your situation</li>
            <li>Get personalized insights</li>
            <li>Explore alternative options</li>
        </ul>
    </div>

    <div class="info-card">
        <h3>Risk Levels</h3>
        <div class="risk-legend">
            <div class="risk-item">
                <span class="badge low">LOW</span>
                <span>≤30% of disposable income</span>
            </div>
            <div class="risk-item">
                <span class="badge medium">MEDIUM</span>
                <span>30-60% of disposable income</span>
            </div>
            <div class="risk-item">
                <span class="badge high">HIGH</span>
                <span>>60% of disposable income</span>
            </div>
            <div class="risk-item">
                <span class="badge hard-stop">STOP</span>
                <span>Cannot afford this purchase</span>
            </div>
        </div>
    </div>

    <div class="info-card">
        <h3>Example</h3>
        <p><strong>Scenario:</strong> Monthly income KSH 5000, expenses KSH 1500, savings goal KSH 500</p>
        <p><strong>Disposable:</strong> KSH 3000</p>
        <p><strong>Purchase:</strong> KSH 1200 laptop</p>
        <p><strong>Result:</strong> LOW RISK (40% of disposable)</p>
    </div>
</section>
{% endblock %}
